<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Bezpečný FTP server na Ubuntu 10.04 LTS</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech"><meta property="og:url" content="http://blog.zapletalovi.com/posts/2010-07-14-bezpecny-ftp-server-na-ubuntu-1004-lts/"><meta property="og:type" content="website"><meta property="og:title" content="Bezpečný FTP server na Ubuntu 10.04 LTS"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Bezpečný FTP server na Ubuntu 10.04 LTS"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="http://blog.zapletalovi.com/posts/2010-07-14-bezpecny-ftp-server-na-ubuntu-1004-lts/"><meta property="twitter:url" content="http://blog.zapletalovi.com/posts/2010-07-14-bezpecny-ftp-server-na-ubuntu-1004-lts/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=http://blog.zapletalovi.com/posts/2010-07-14-bezpecny-ftp-server-na-ubuntu-1004-lts/><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=http://blog.zapletalovi.com/css/dark.css><script src=http://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=http://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=http://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://blog.zapletalovi.com><img src=http://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=http://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Bezpečný FTP server na Ubuntu 10.04 LTS</h1><small role=doc-subtitle></small><p class=post-date>July 14, 2010</p><ul class=post-tags></ul></div><div class=post-content><p>Potřeboval jsem rozjet zabezpečený FTP server pro jednoho uživatele. To znamená žádný anonymní přístup, přístup pouze pro lokálního uživatele. Jelikož byly nutné nějaké ty úpravy v konfiguračních souborech, tak se o to s vámi podělím.<br><br>Použil jsem vsftpd server.<br><br><i>#&nbsp;sudo apt-get install openssl vsftpd</i><br><br>Vytvořil jsem uživatele "upload" s domovským adresářem jinde než v /home.<br><br><i># useradd -d /mnt/bigdata/UPLOAD -s /bin/false upload</i><br><i>#&nbsp;chown upload /mnt/bigdata/UPLOAD</i><br><i>#&nbsp;passwd upload</i><br><br>Nyní zapeklitý krok, který mě stál 20 minut bádání. Je potřeba vypnout kontrolu shellu pro uživatele. Toto se sice dá vypnout přímo v konfiguračním souboru vsftpd (check_shell=NO), ale pakliže vsftpd použivá PAM (v Ubuntu standardně ano), tak by to nefungovalo. Je potřeba zakomentovat řádek v souboru&nbsp;/etc/pam.d/vsftpd (ten poslední) takto:<br><br><br><i># Standard behaviour for ftpd(8).</i><br><i>auth &nbsp; &nbsp;required &nbsp; &nbsp; &nbsp; &nbsp;pam_listfile.so item=user sense=deny file=/etc/ftpusers onerr=succeed</i><br><i># Note: vsftpd handles anonymous logins on its own. Do not enable pam_ftp.so.</i><br><i># Standard pam includes</i><br><i>@include common-account</i><br><i>@include common-session</i><br><i>@include common-auth</i><br><i><b>#auth &nbsp; required &nbsp; &nbsp; &nbsp; &nbsp;pam_shells.so</b></i><br><br><br>Nyní můžeme přistoupit ke konfiguraci vsftpd. Standardní konfigurace až na jednu výjimku bude vyhovovat, takže nejprve zeditujeme soubor /etc/vsftpd.conf, projdeme si nastavení a nastavíme tyto hodnoty:<br><br><i># Vypnout anonymni ucet</i><br><br><i>anonymous_enable=NO</i><br><br><i># Zapnout lokalni ucty</i><br><br><i>local_enable=YES</i><br><i># Zapis ano</i><br><i>write_enable=YES</i><br><i><br></i><br><i># Dalsi nastaveni dle libosti (neni nutne ale nic menit)</i><br><i><br></i><br><i># Nasledujici radek ZAKOMENTUJTE</i><br><i>#rsa_cert_file=/etc/ssl/private/vsftpd.pem</i><br><br><br>Nyní by FTP server měl fungovat lokálně s lokálními účty. Můžete to vyzkoušet příkazem telnet localhost 21 a zadáním příkazů USER xxx a PASS xxx. Poté dejte QUIT.<br><br>Nyní nastavíme zabezpečení (SSL/TLS), jeho vynucení a nastavíme správné certifikáty (v default konfiguraci nebyla cesta k certifikátu správná):<br><br><br><i># Certifikaty z Ubuntu LTS 10.04</i><br><i>rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem</i><br><i>rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</i><br><i><br></i><br><i># Aktivace SSL a nastaveni (pouze pro lokalni)</i><br><i>ssl_enable=YES</i><br><i>force_local_data_ssl=YES</i><br><i>force_local_logins_ssl=YES</i><br><i>ssl_tlsv1=YES</i><br><i>ssl_sslv2=YES</i><br><i>ssl_sslv3=YES</i><br><i><br></i><br><i># Omezeni portu kvuli firewallu</i><br><i>pasv_min_port=12000</i><br><i>pasv_max_port=12100</i><br><div><br></div><br>Nemusíte žádné certifikáty generovat - použil jsem ty základní, které se automaticky generují při instalaci balíku openssl. Restart.<br><br><i># service vsftpd restart</i><br><br>A je to. Nyní zbývá nastavit firewall, aby byl server dostupný z internetu. Může to být ADSL modem nebo WIFI AP, cokoli. Stačí vám přesměřovat na lokální server následující externí porty: 21, 12000-12100.<br><br>Nyní se můžete připojit z internetu. Nezapomeňte použít TLS/SSL připojení (normální nebude fungovat) a také pasivní režim.</p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>