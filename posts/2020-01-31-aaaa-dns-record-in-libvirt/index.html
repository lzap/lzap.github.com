<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>AAAA DNS record in libvirt</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora"><meta property="og:url" content="http://blog.zapletalovi.com/posts/2020-01-31-aaaa-dns-record-in-libvirt/"><meta property="og:type" content="website"><meta property="og:title" content="AAAA DNS record in libvirt"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="AAAA DNS record in libvirt"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="http://blog.zapletalovi.com/posts/2020-01-31-aaaa-dns-record-in-libvirt/"><meta property="twitter:url" content="http://blog.zapletalovi.com/posts/2020-01-31-aaaa-dns-record-in-libvirt/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=http://blog.zapletalovi.com/posts/2020-01-31-aaaa-dns-record-in-libvirt/><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=http://blog.zapletalovi.com/css/dark.css><script src=http://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=http://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=http://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://blog.zapletalovi.com><img src=http://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=http://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>AAAA DNS record in libvirt</h1><small role=doc-subtitle></small><p class=post-date>January 31, 2020</p><ul class=post-tags><li class=post-tag><a href=http://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=http://blog.zapletalovi.com/tags/fedora>fedora</a></li></ul></div><div class=post-content><p><p>Hello, for some time now it&rsquo;s possible to create AAAA DNS records in a libvirt
virtual network. It&rsquo;s very similar to creating A records (or host records) and
they are meant for allocating IP addresses to hosts but since libvirt uses
dnsmasq which handles both DHCP and DNS records, you can take advantage for
this and create arbitrary records.</p><p>This is useful if you want to do PXE or UEFI HTTP Boot provisioning in an IPv6
only virtual network with full DNS working setup for example because of X.509.</p><p>To create a DHCP with A record, a <code>&lt;host/></code> element in <code>&lt;ip/></code> - <code>&lt;dhcp/></code>
element must be created:</p><pre><code>&lt;host name=&quot;a.host.lan&quot; mac=&quot;aa:bb:cc:dd:ee:ff&quot; ip=&quot;10.0.0.13&quot;/&gt;
</code></pre><p>For AAAA, it&rsquo;s essentially the same except there is no MAC attribute, instead
ID (client ID) can be optionally provided but that&rsquo;s only useful for IP
assignment:</p><pre><code>&lt;host name=&quot;gw.dhcpsix.lan&quot; ip=&quot;fd00:bbbb:cccc:dd::1&quot;/&gt;
</code></pre><p>Here is an example of IPv6 DHCP virtual network with a host entry:</p><pre><code>&lt;network&gt;
  &lt;name&gt;dhcpsix.lan&lt;/name&gt;
  &lt;uuid&gt;422ded85-a29b-428e-9cb0-a48bf6299b5c&lt;/uuid&gt;
  &lt;forward mode=&quot;nat&quot;/&gt;
  &lt;bridge name=&quot;virbr2&quot; stp=&quot;on&quot; delay=&quot;0&quot;/&gt;
  &lt;mac address=&quot;52:54:00:e6:57:da&quot;/&gt;
  &lt;domain name=&quot;dhcpsix.lan&quot;/&gt;
  &lt;ip family=&quot;ipv6&quot; address=&quot;fd00:bbbb:cccc:dd::1&quot; prefix=&quot;64&quot;&gt;
    &lt;dhcp&gt;
      &lt;range start=&quot;fd00:bbbb:cccc:dd::100&quot; end=&quot;fd00:bbbb:cccc:dd::1ff&quot;/&gt;
      &lt;host name=&quot;gw.dhcpsix.lan&quot; ip=&quot;fd00:bbbb:cccc:dd::1&quot;/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
</code></pre><p>To add the <code>&lt;host/></code> line, just use virt-manager which recently received XML
editing capability or simply use <code>virsh net-edit dhcpsix.lan</code> to edit the
configuration. Restart the network then, not host nework but libvirt virtual
network. Again, you can use virt-manager or virsh command to do that.</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>