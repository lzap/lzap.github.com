<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Capturing Ruby backtrace in Sublime Text 3</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech"><meta property="og:url" content="http://blog.zapletalovi.com/posts/2018-09-05-capturing-ruby-backtrace-in-sublime-text-3/"><meta property="og:type" content="website"><meta property="og:title" content="Capturing Ruby backtrace in Sublime Text 3"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Capturing Ruby backtrace in Sublime Text 3"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="http://blog.zapletalovi.com/posts/2018-09-05-capturing-ruby-backtrace-in-sublime-text-3/"><meta property="twitter:url" content="http://blog.zapletalovi.com/posts/2018-09-05-capturing-ruby-backtrace-in-sublime-text-3/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=http://blog.zapletalovi.com/posts/2018-09-05-capturing-ruby-backtrace-in-sublime-text-3/><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=http://blog.zapletalovi.com/css/dark.css><script src=http://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=http://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=http://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://blog.zapletalovi.com><img src=http://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=http://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Capturing Ruby backtrace in Sublime Text 3</h1><small role=doc-subtitle></small><p class=post-date>September 5, 2018</p><ul class=post-tags><li class=post-tag><a href=http://blog.zapletalovi.com/tags/linux>linux</a></li></ul></div><div class=post-content><p><p>I am a heavy Vim user for over two decades now, but from time to time I want to
give break to my hands and just browse code with mouse while doing reviews.
This is where Vim is not good at, I&rsquo;ve never felt in love with NERDTree plugin
or these kind of stuff. Directory tree simply doesn&rsquo;t look good in terminal.
From all the modern editors like Textmate, Atom, VSCode and similar I like
Sublime Text the most.</p><p>Being able to execute Ruby code or tests from Sublime Text is nice, it provides
a regular expression parser to make backtrace &ldquo;clickable&rdquo;. It comes with
definition for Ruby:
<a href=https://github.com/sublimehq/Packages/blob/master/Ruby/Ruby.sublime-build>https://github.com/sublimehq/Packages/blob/master/Ruby/Ruby.sublime-build</a></p><pre><code>{
  &quot;shell_cmd&quot;: &quot;ruby \&quot;$file\&quot;&quot;,
  &quot;file_regex&quot;: &quot;^(...*?):([0-9]*):?([0-9]*)&quot;,
  &quot;selector&quot;: &quot;source.ruby&quot;
}
</code></pre><p>The thing is - it does not work in most cases.</p><p>There are multiple backtrace formatting in Ruby. In versions 1.8 - 2.4 the
format is:</p><pre><code>test.rb:7:in `partridges': Shouldn't this be recursive? (RuntimeError)
  from test.rb:3:in `turtle_doves'
  from test.rb:10:in `&lt;main&gt;'
</code></pre><p>Starting from Ruby 2.5 it&rsquo;s reversed with index numbers:</p><pre><code>Traceback (most recent call last):
  2: from test.rb:10:in `&lt;main&gt;'
  1: from test.rb:3:in `turtle_doves'
test.rb:7:in `partridges': Shouldn't this be recursive? (RuntimeError)
</code></pre><p>The regular expression in Sublime Text 3 (build from summer 2018) does only
capture line 7 and completly ignores &ldquo;from&rdquo; lines. But there&rsquo;s more, exceptions
are often printed to console via <code>backtrace</code> call from <code>Exception</code> class from
Ruby standard library. An example from our application:</p><pre><code>E, [2017-01-16T12:15:59.678835 #32142] ERROR -- : undefined method `join' for #&lt;String:0x007f1a587784a8&gt; (NoMethodError)
/usr/share/sinatra-1.3.5/lib/sinatra/showexceptions.rb:37:in `rescue in call'
/usr/share/sinatra-1.3.5/lib/sinatra/showexceptions.rb:21:in `call'
/usr/share/sinatra-1.3.5/lib/sinatra/base.rb:124:in `call'
...
</code></pre><p>Testing frameworks does the same often prepending whitespace (tab usually) for
each line:</p><pre><code>NoMethodError: undefined method `render' for &quot;test&quot;:String
    app/models/host/base.rb:351:in `render_template'
    /home/lzap/work/foreman_discovery/lock_templates.rb:14:in `block in lock_templates'
    /home/lzap/work/foreman_discovery/lock_templates.rb:10:in `each'
    /home/lzap/work/foreman_discovery/lock_templates.rb:10:in `lock_templates'
</code></pre><p>Sublime Text needs a regular expression which captures them all. I had to find
how to do non-capturing group in Sublime regular parser and the rest was easy:</p><pre><code>{
  &quot;shell_cmd&quot;: &quot;ruby \&quot;$file\&quot;&quot;,
  &quot;file_regex&quot;: &quot;^\\s*(?:\\d:)?\\s*(?:from )?([^:]+):(\\d+):in&quot;,
  &quot;selector&quot;: &quot;source.ruby&quot;
}
</code></pre><p>I filed a PR in the Sublime Packages repo with the change: <a href=https://github.com/sublimehq/Packages/pull/1706>https://github.com/sublimehq/Packages/pull/1706</a></p><p>That should do it. Have fun!</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>