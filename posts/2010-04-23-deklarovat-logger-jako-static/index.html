<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Deklarovat logger jako static?</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,oldblog"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2010-04-23-deklarovat-logger-jako-static/"><meta property="og:type" content="website"><meta property="og:title" content="Deklarovat logger jako static?"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Deklarovat logger jako static?"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2010-04-23-deklarovat-logger-jako-static/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2010-04-23-deklarovat-logger-jako-static/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2010-04-23-deklarovat-logger-jako-static/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Deklarovat logger jako static?</h1><small role=doc-subtitle></small><p class=post-date>April 23, 2010</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/oldblog>oldblog</a></li></ul></div><div class=post-content><p><i><span class=Apple-style-span style=font-style:normal></span></i><br><i><h1><span class=Apple-style-span style=font-size:medium;font-weight:400><i><span class=Apple-style-span style=font-style:normal><div class=level1 style=display:inline!important><div style=display:inline!important>Často se sám sebe na začátku každého projektu zeptám –&nbsp;<em>budu deklarovat loggery jako statické</em>? Jinak řečeno, budou začátky tříd vypadat takto:</div></div></span></i></span></h1><div class=level1><pre class="code java"><span class=kw1>public</span> <span class=kw1>class</span> Foo <span class=br0>{</span><br>  <span class=kw1>private</span> <span class=kw1>static</span> <span class=kw1>final</span> Log log <span class=sy0>=</span> LogFactory.<span class=me1>getLog</span><span class=br0>(</span>Foo.<span class=kw1>class</span><span class=br0>)</span><span class=sy0>;</span><br>  ....<br><span class=br0>}</span></pre>A nebo takto:<br><pre class="code java"><span class=kw1>public</span> <span class=kw1>class</span> Foo <span class=br0>{</span><br>  <span class=kw1>private</span> <span class=kw1>final</span> Log log <span class=sy0>=</span> LogFactory.<span class=me1>getLog</span><span class=br0>(</span>Foo.<span class=kw1>class</span><span class=br0>)</span><span class=sy0>;</span><br>  ....<br><span class=br0>}</span></pre><pre class="code java"><span class=br0><br></span></pre><pre class="code java"><span class=Apple-style-span style="font-family:times new roman;white-space:normal"><i><span class=Apple-style-span style=font-style:normal><div class=level1 style=display:inline!important><div style=display:inline!important>Oba přístupy mají svá pro i proti.</div></div></span></i></span></pre><pre class="code java"><span class=Apple-style-span style="font-family:times new roman;white-space:normal"><i><span class=Apple-style-span style=font-style:normal><div class=level1 style=display:inline!important><div style=display:inline!important><br></div></div></span></i></span></pre>V&nbsp;<strong>prvním případě</strong>&nbsp;(statickém) je pro menší využití paměti a program bude o něco rychlejší – není třeba pro každou instanci vytvářet logger. Také nebývá problém při serializaci, kdy načtená třída bez problémů funguje. Ovšem do problému se můžeme dostat, pakliže máme logovací knihovny v J2EE serveru umístěny ve sdíleném prostoru (classloaderu) a na serveru je více instancí stejné aplikace nebo knihovny, které logují. Pak nebude možné od sebe odlišit jednotlivé instance, takže kdybyste chtěli mít logy z jedné aplikace v jiném souboru, než logy z druhé, tak to nebude možné. Situaci musíte řešit na aplikační úrovni.<br><br><strong>Druhý případ</strong>&nbsp;(nestatický – instanční) tímto problémem netrpí a navíc se s ním lépe pracuje v IoC. Ale pozor – problém s classloaderem je vyřešen pouze v knihovných logback a log4j – nejnovějších verzích. Pokud používáte jinou logovací knihovnu (jul), máte smůlu a můžete použít static. Ovšem přístup má i nevýhody: situaci je třeba explicitně řešit při deserializaci (readResolve), a tento přístup je také pomalejší a bere více procesorového času.<br><br>Takže&nbsp;<strong>rada zní</strong>: pokud jste si opravdu jisti, ale tím myslím na sto procent jisti, že aplikace nebude provozována ve více instancích na stejném aplikačním serveru, tak&nbsp;<strong>přesto</strong>&nbsp;používejte instanční (pomalejší) přístup. No – teď si dělám srandu. Pochopitelně, že můžete použít statický přístup. Ten instanční použijte jen tehdy, kdy máte jako logující implementaci novější verze knihoven log4j nebo logback (to je nástupce log4j).<br><br><strong>Druhá rada</strong>&nbsp;je pak prostá:&nbsp;<em>snažte se</em>&nbsp;o jednotný přístup.<br><br>A konečně&nbsp;<strong>třetí rada</strong>: využijte svoje programovací prostředí naplno. Většina IDE nabízí možnost vytvoření šablony pro novou třídu, což lze využít pro&nbsp;<a class=wikilink1 href=file:///C:/Documents%20and%20Settings/lzapletal/My%20Documents/Download/oldblog/oldblog/blog/sikovne_sablony_pro_eclipse.html title=blog:sikovne_sablony_pro_eclipse>nadefinování loggeru</a>&nbsp;i jiným věcem.<br>Mimochodem, když už se rozhodnete pro instance, pak lze zápis „zkrášlit“ voláním metody getClass() – tím pádem nemusíte logger upravovat, když děláte copy&paste. A ruku na srdce – to děláte často, že?<br><br><pre class="code java"><span class=kw1>public</span> <span class=kw1>class</span> Foo <span class=br0>{</span><br>  <span class=kw1>private</span> <span class=kw1>final</span> Log log <span class=sy0>=</span> LogFactory.<span class=me1>getLog</span><span class=br0>(</span>getClass<span class=br0>(</span><span class=br0>)</span><span class=br0>)</span><span class=sy0>;</span><br>  ....<br><span class=br0>}</span></pre><pre class="code java"><span class=br0><br></span></pre>U všech případů platí, že je vhodné deklarovat logger jako privátní. Pokud bychom totiž umožnili potomkům přístup na logger, mohlo by se stát, že by se v logu objevovaly zprávy potomků pod identifikátorem (názvem třídy) předka. Obecně platí jedno pravidlo –&nbsp;<strong>nikdy nepoužívejte logger předka</strong>. Za každých okolností musí mít každá třída svůj logger, leda byste měli vystavěný nějaký aparát, který by dodával správné identifikátory.<br><br><em>Pozn.: Původně jsem klíčové slovo private chybně neuváděl. Je potřeba jej ale z výše uvedených důvodů uvést. Díky za upozornění v diskusi.</em><br><em><br></em><br><br><br><div class=notetip>Uvedené příklady jsou pro knihovnu-fasádu commons-logging, v ostatních případech (fasáda slf4j, knihovny log4j, logback, juli a další) bude kód vypadat trošičku jinak, a to jen v některých případech.</div><div class=notetip><br></div><br><br>A poslední dodatek se týká klíčového slova&nbsp;<strong>final</strong>. Můžete jej uvádět vždy, když nebudete logger modifikovat (drtivá většina případů), může to pomoct kompilátoru/virtuálnímu stroji. Případ, kdy není vhodné slovo final uvést, již byl uveden výše – například při deserializaci a implementaci metody readResolve().<br><br><strong>Další zdroje</strong><br><ul><li class=level1><div class=li><a class=urlextern href=http://wiki.apache.org/jakarta-commons/Logging/StaticLog rel=nofollow title=http://wiki.apache.org/jakarta-commons/Logging/StaticLog>http://wiki.apache.org/jakarta-commons/Logging/StaticLog</a></div></li><li class=level1><div class=li><a class=urlextern href=http://www.slf4j.org/faq.html#declared_static rel=nofollow title=http://www.slf4j.org/faq.html#declared_static>http://www.slf4j.org/faq.html#declared_static</a></div></li></ul></div></i><br><i><br></i><br><i>Tento zápisek vznikl převodem z mého starého blogu. Ne všechny texty byly takto převedeny, kompletní archiv již není k dispozici.</i></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>