<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Accessing libvirt VMs via telnet</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora,rhel,libvirt"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2018-02-20-accessing-libvirt-vms-via-telnet/"><meta property="og:type" content="website"><meta property="og:title" content="Accessing libvirt VMs via telnet"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Accessing libvirt VMs via telnet"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2018-02-20-accessing-libvirt-vms-via-telnet/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2018-02-20-accessing-libvirt-vms-via-telnet/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2018-02-20-accessing-libvirt-vms-via-telnet/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Accessing libvirt VMs via telnet</h1><small role=doc-subtitle></small><p class=post-date>February 20, 2018</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/fedora>fedora</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/rhel>rhel</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/libvirt>libvirt</a></li></ul></div><div class=post-content><p><p>There are many &ldquo;tricks&rdquo; floating around how to connect to VM when you have a
networking issue and ssh is not available. The idea is to use serial console to
get shell access. Here is how to do this properly with RHEL7 host and guest.</p><p>First, create a VM with serial console configured with <a href=https://libvirt.org/formatdomain.html#elementsCharTCP>remote TCP
server</a>. There are
multiple options, I find TCP server in &rsquo;telnet&rsquo; mode the most flexible
configuration because most scripting languages has the protocol built-in. You
can use virt-manager or virt-install to do that:</p><pre><code>&lt;devices&gt;
  &lt;serial type=&quot;tcp&quot;&gt;
    &lt;source mode=&quot;connect&quot; host=&quot;0.0.0.0&quot; service=&quot;4555&quot;/&gt;
    &lt;protocol type=&quot;telnet&quot;/&gt;
    &lt;target port=&quot;0&quot;/&gt;
  &lt;/serial&gt;
&lt;/devices&gt;
</code></pre><p>Boot the VM and then enable getty:</p><pre><code>$ systemctl enable serial-getty@ttyS0.service
$ systemctl start serial-getty@ttyS0.service
</code></pre><p>That&rsquo;s all, access the console interactively:</p><pre><code>$ telnet localhost 4555
</code></pre><p>To access &lsquo;raw&rsquo; console (protocol type in the XML snippet above), use netcat or
similar tool. Other options in libvirt are logfile, UDP, pseudo TTY, named
pipe, unix socket or null. You get the idea.</p><p>When creating multiple serial devices, only the first one (<code>ttyS0</code>) is allowed
for root access by default. To enable second one, do:</p><pre><code>$ echo ttyS1 &gt;&gt; /etc/securetty
</code></pre><p>That&rsquo;s all for today.</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>