<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Foreman and PXE less environments</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,foreman"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2015-10-07-foreman-and-pxe-less-environments/"><meta property="og:type" content="website"><meta property="og:title" content="Foreman and PXE less environments"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Foreman and PXE less environments"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2015-10-07-foreman-and-pxe-less-environments/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2015-10-07-foreman-and-pxe-less-environments/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2015-10-07-foreman-and-pxe-less-environments/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Foreman and PXE less environments</h1><small role=doc-subtitle></small><p class=post-date>October 7, 2015</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/foreman>foreman</a></li></ul></div><div class=post-content><p><p>Foreman (and Satellite 6) has many options when it comes to provisioning in
PXE-less (or DHCP-less) environments.</p><p>Option 1: <em>Bootdisk plugin - iPXE</em></p><p>Foreman Bootdisk plugin enables Foreman users to download <em>Host based</em> or
<em>Generic host</em> images. These are small ISO images pre-loaded with SYSLINUX which
chainloads <a href=http://ipxe.org>iPXE</a>. This kind of firmware is able to load
kernels via http, but hardware driver in iPXE <em>must</em> exist for this to work.
Unfortunately, there are many issues with various hardware and even
virtualization technologies (VMWare, Microsoft).</p><p>The <em>host image</em> embeds network credentials (IP, gateway, netmask, DNS)
therefore DHCP is not requred but the host is bound to the host it was
generated for. On the other hand, Generic image initializes network via DHCP
and can be used with any host. Recent version of Foreman will add Subnet
image, which is a Generic image but proxies the http calls via Smart Proxy
(Templates plugin must be enabled).</p><p>Option 2: <em>Bootdisk plugin - SYSLINUX</em></p><p>There is a special kind of image: Full host image. This one is host-based (not
generic) image that requires DHCP. It contains SYSLINUX loader, configuration
rendered from PXELinux template kind associated with the host and embedded
Linux kernel and init RAM disk of the associated OS installer. The image is
slightly bigger, but it works on most platforms as the initial network
configuration is done by the OS installer (e.g. Anaconda from RHEL).</p><p>Although this image type requires DHCP, there is a trick to get it working
with static configuration. Create the following PXELinux kind template and
associate it with the OS/Host, then download the image:</p><pre><code>&lt;%
  mac = @host.primary_interface.mac
  bootif = '00-' + mac.gsub(':', '-') if mac
  ip = @host.primary_interface.ip
  mask = @host.primary_interface.subnet.mask
  gw = @host.primary_interface.subnet.gateway
  dns = @host.primary_interface.subnet.dns_primary
-%&gt;
DEFAULT linux
LABEL linux
KERNEL &lt;%= @kernel %&gt;
&lt;% if (@host.operatingsystem.name == 'Fedora' and @host.operatingsystem.major.to_i &gt; 16) or
    (@host.operatingsystem.name != 'Fedora' and @host.operatingsystem.major.to_i &gt;= 7) -%&gt;
APPEND initrd=&lt;%= @initrd %&gt; ks=&lt;%= foreman_url('provision') + &quot;&amp;static=yes&quot; %&gt; inst.ks.sendmac &lt;%= &quot;ip=#{ip}::#{gw}:#{mask}:::none nameserver=#{dns} ksdevice=bootif BOOTIF=#{bootif}&quot; %&gt;
&lt;% else -%&gt;
APPEND initrd=&lt;%= @initrd %&gt; ks=&lt;%= foreman_url('provision') + &quot;&amp;static=yes&quot; %&gt; kssendmac &lt;%= &quot;ip=#{ip} netmask=#{mask} gateway=#{gw} dns=#{dns} ksdevice=#{mac} BOOTIF=#{bootif}&quot; %&gt;
&lt;% end -%&gt;
</code></pre><p>For Foreman 1.6 or older (or Satellite 6.0-6.1) use this one:</p><pre><code>&lt;%
  mac = @host.mac
  bootif = '00-' + mac.gsub(':', '-') if mac
  ip = @host.ip
  mask = @host.subnet.mask
  gw = @host.subnet.gateway
  dns = @host.subnet.dns_primary
-%&gt;
DEFAULT linux
LABEL linux
KERNEL &lt;%= @kernel %&gt;
&lt;% if (@host.operatingsystem.name == 'Fedora' and @host.operatingsystem.major.to_i &gt; 16) or
    (@host.operatingsystem.name != 'Fedora' and @host.operatingsystem.major.to_i &gt;= 7) -%&gt;
APPEND initrd=&lt;%= @initrd %&gt; ks=&lt;%= foreman_url('provision') + &quot;&amp;static=yes&quot; %&gt; inst.ks.sendmac &lt;%= &quot;ip=#{ip}::#{gw}:#{mask}:::none nameserver=#{dns} ksdevice=bootif BOOTIF=#{bootif}&quot; %&gt;
&lt;% else -%&gt;
APPEND initrd=&lt;%= @initrd %&gt; ks=&lt;%= foreman_url('provision') + &quot;&amp;static=yes&quot; %&gt; kssendmac &lt;%= &quot;ip=#{ip} netmask=#{mask} gateway=#{gw} dns=#{dns} ksdevice=#{mac} BOOTIF=#{bootif}&quot; %&gt;
&lt;% end -%&gt;
</code></pre><p>The template passes network credentials from Foreman Host via SYSLINUX
configuration file into Anaconda. This is an example for Red Hat or Fedora
systems. Keep in mind that provisioning token is embedded in the image, so
Host record <em>must</em> be present (the image is <em>not</em> generic).</p><p>For more info visit <a href=https://github.com/theforeman/foreman_bootdisk>Foreman
Bootdisk</a></p><p>Option 3: <em>Discovery ISO</em></p><p>In Foreman 1.10, Discovery image (version 3.0.1+) together with Foreman
Discovery plugin 4.1.1+ can be used to discover systems via CD/DVD-ROM or USB
stick. In this workflow, discovered hosts are either manually or automatically
(via Discovery Rules) provisioned and kernel is replaced with installer using
kexec technology.</p><p>It works in both DHCP or DHCP-less environments as the ISO image can be
&ldquo;remastered&rdquo; with a script providing network credentials via SYSLINUX
configuration similarly as in Full host image.</p><p>For more info visit <a href=http://theforeman.org/plugins/foreman_discovery/4.0/index.html>Foreman Discovery
documentation</a></p><p>Documentation for this feature is currently being finished. The draft is
<a href=https://github.com/theforeman/theforeman.org/pull/421/files>available here</a>.</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>