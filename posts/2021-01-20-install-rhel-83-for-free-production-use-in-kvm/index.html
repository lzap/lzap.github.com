<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Install RHEL 8.3 for free production use in a VM</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2021-01-20-install-rhel-83-for-free-production-use-in-kvm/"><meta property="og:type" content="website"><meta property="og:title" content="Install RHEL 8.3 for free production use in a VM"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Install RHEL 8.3 for free production use in a VM"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2021-01-20-install-rhel-83-for-free-production-use-in-kvm/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2021-01-20-install-rhel-83-for-free-production-use-in-kvm/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2021-01-20-install-rhel-83-for-free-production-use-in-kvm/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Install RHEL 8.3 for free production use in a VM</h1><small role=doc-subtitle></small><p class=post-date>January 20, 2021</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/fedora>fedora</a></li></ul></div><div class=post-content><p><p>In January 2021, Red Hat
<a href=https://www.redhat.com/en/blog/new-year-new-red-hat-enterprise-linux-programs-easier-ways-access-rhel>announced</a>
that Red Hat Enterprise Linux can be used at no cost for up to 16 production
servers. In this article, I want to provide step-by-step instructions on how to
install RHEL 8.3 in a VM.</p><p>First off, <a href=https://access.redhat.com/downloads>download</a> the official and
updated QCOW2 image named <code>rhel-8.3-x86_64-kvm.qcow2</code> (the name will likely
change later as RHEL moves to higher versions). Creating an account on the Red
Hat Portal is free, there is an integration with 3rd party authorization
services like GitHub, Twitter or Facebook, however for successful host
registration username and password needs to be created.</p><p>To use RHEL in a cloud environment like Amazon, Azure or OpenStack, simply
upload the image and start it. It&rsquo;s cloud-init ready, make sure to seed the
instance with data like usernames, passwords and/or ssh-keys. Note that root
account is locked, there is no way to log in without seeding initial
information.</p><p>To start RHEL in QEMU/KVM, libvirt or oVirt (Red Hat Virtualization), <a href=https://access.redhat.com/solutions/641193>several
steps</a> must be performed: root
password should be set, cloud-init must be uninstalled and optionally user
account(s) with password or ssh key should be created.</p><pre><code>$ virt-customize -a rhel-8.3-x86_64-kvm.qcow2 --root-password password:redhat --uninstall cloud-init --hostname rhel8-registered
[   0.0] Examining the guest ...
[  11.5] Setting a random seed
[  11.5] Setting the machine ID in /etc/machine-id
[  11.5] Uninstalling packages: cloud-init
[  28.7] Setting passwords
[  45.2] Finishing off
</code></pre><p>The utility virt-customize, available in Fedora, RHEL and most other Linux
distributions, is <a href=https://libguestfs.org/virt-customize.1.html>extremely
flexible</a> allowing pretty much
any change from creating users, installing packages, applying updates. We will
stick with setting up the root password and hostname for now. Note the utility
performs actions on the original image, make sure to have a copy just for case.</p><pre><code>$ sudo virt-install \
  --name rhel8-registered \
  --memory 2048 \
  --vcpus 2 \
  --disk /var/lib/libvirt/images/rhel-8.3-x86_64-kvm.qcow2 \
  --import \
  --os-variant rhel8.3
</code></pre><p>Once the host boots up, login and register the system. Use the same credentials
as for accessing the Red Hat Portal:</p><pre><code>rhel8# subscription-manager register --username lzap
Password: **********
The system has been registered with ID: XXXXXXXXXXXXXXXXXXXXXXXXXXX
</code></pre><p>This step can be also done via the <code>virt-customize</code> utility or automated via
Ansible. And that&rsquo;s it! Start installing software or updating the node:</p><pre><code>rhel8# dnf update; dnf install vim-enhanced
</code></pre><p>It is worth nothing that <code>subscription-manager</code> runs a deamon which
periodically checks-in and uploads installed packages and some hardware facts
about the system. You can review registered systems on the <a href=https://access.redhat.com/management>Subscription
Portal</a>. From there, package and errata
information can be displayed (security vulnerabilities) as well as
repositories, modules and system facts. Note that it is not possible to manage
hosts via Red Hat Portal, nodes can be unregistered tho.</p><p>Although I haven&rsquo;t tested this, to convert QCOW2 image to VMWare, perform the
following after the image was modified via <code>virt-customize</code>:</p><pre><code># qemu-img convert -f qcow2 -O vmdk rhel-8.3-x86_64-kvm.qcow2 rhel-8.3-x86_64-kvm.vmdk
</code></pre><p>To install on a bare-metal node, download one of the installation DVDs, attach
it to the CDROM device or burn and insert physical copy (who does that in 2021
really) and follow the on-screen instructions. Use Red Hat Portal credentials
when asked to register the system.</p><p>If you plan to manage fleet of RHEL servers, check out
<a href=https://theforeman.org>Foreman</a> project which is the upstream for Red Hat
Satellite management platform. Note that content management features provided
by Katello plugin will not work on zero-cost accounts, but other features like
provisioning, remote execution and configuration management will work perfectly
fine with self-supported Red Hat Enterprise Linux nodes registered directly to
Red Hat Portal.</p><p>Red Hat Enterprise Linux is a reliable and trusted Linux operating system
available free of charge for up to 16 production instances. Feel free to ask on
the <a href=https://access.redhat.com/discussions>discussion forums</a>. By the way, Red
Hat Portal contains ton of curated and useful stuff, documentation, articles,
howtos, discussion and video content.</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>