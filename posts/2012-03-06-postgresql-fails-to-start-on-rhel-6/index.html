<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>PostgreSQL fails to start on RHEL 6 sometimes</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora,rhel,postgresql"><meta property="og:url" content="http://blog.zapletalovi.com/posts/2012-03-06-postgresql-fails-to-start-on-rhel-6/"><meta property="og:type" content="website"><meta property="og:title" content="PostgreSQL fails to start on RHEL 6 sometimes"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="PostgreSQL fails to start on RHEL 6 sometimes"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="http://blog.zapletalovi.com/posts/2012-03-06-postgresql-fails-to-start-on-rhel-6/"><meta property="twitter:url" content="http://blog.zapletalovi.com/posts/2012-03-06-postgresql-fails-to-start-on-rhel-6/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=http://blog.zapletalovi.com/posts/2012-03-06-postgresql-fails-to-start-on-rhel-6/><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=http://blog.zapletalovi.com/css/dark.css><script src=http://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=http://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=http://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://blog.zapletalovi.com><img src=http://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=http://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>PostgreSQL fails to start on RHEL 6 sometimes</h1><small role=doc-subtitle></small><p class=post-date>March 6, 2012</p><ul class=post-tags><li class=post-tag><a href=http://blog.zapletalovi.com/tags/fedora>fedora</a></li><li class=post-tag><a href=http://blog.zapletalovi.com/tags/rhel>rhel</a></li><li class=post-tag><a href=http://blog.zapletalovi.com/tags/postgresql>postgresql</a></li></ul></div><div class=post-content><p>We were having issues with PostgreSQL startup and it was pretty undeterministic. For some reason, PostgreSQL failed to start <b>from time to time</b>:<br><br><br><i>[root@beta ~]# service postgresql start</i><br><i>Starting postgresql service: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ &nbsp;FAIL &nbsp;]</i><br><br>Apparently, when I tried to list processes, it was running. Something wrong is with the sysv init script in RHEL 6 or CentOS 6 (or other clones). Quickly checking start function I saw this:<br><br><br><i><span class=Apple-tab-span style=white-space:pre></span>$SU -l postgres -c "$PGENGINE/postmaster -p ...</i><br><i><span class=Apple-tab-span style=white-space:pre></span><b>sleep 2</b></i><br><i><span class=Apple-tab-span style=white-space:pre></span>pid=`head -n 1 "$PGDATA/postmaster.pid" 2>/dev/null`</i><br><i><span class=Apple-tab-span style=white-space:pre></span>if [ "x$pid" != x ]; then</i><br><i><span class=Apple-tab-span style=white-space:pre></span>success "$PSQL_START"</i><br><i><span class=Apple-tab-span style=white-space:pre></span>else</i><br><i><span class=Apple-tab-span style=white-space:pre></span>failure "$PSQL_START"</i><br><i><span class=Apple-tab-span style=white-space:pre></span>fi</i><br><div><br></div><div>I simplified the bit a bit, but you should see it. Start, wait two seconds, then try to locate the pid file. If it's not there, report error. Oops.</div><div><br></div><div>On some very slow systems or discs, you can hit this problem. Slow systems? I guess you are pretty sure all your systems are simply <i>fast enough</i> to handle this properly. Well, you may be wrong. In our case it was a virtual hypervisor with a high IO load and in some cases, postgresql startup was a little longer than two seconds. Just a liiiittle bit.</div><div><br></div><div>Good news is this is gonna be fixed very soon, the next Fedora version will probably have systemd startup configuration instead sysv init script. It should work fine then. For older versions, we have filed <a href="https://bugzilla.redhat.com/show_bug.cgi?id=800534">a BZ</a>.</div><br></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>