<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Jak rozchodit LTSP</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,oldblog"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2010-04-22-jak-rozchodit-ltsp/"><meta property="og:type" content="website"><meta property="og:title" content="Jak rozchodit LTSP"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Jak rozchodit LTSP"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2010-04-22-jak-rozchodit-ltsp/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2010-04-22-jak-rozchodit-ltsp/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2010-04-22-jak-rozchodit-ltsp/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Jak rozchodit LTSP</h1><small role=doc-subtitle></small><p class=post-date>April 22, 2010</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/oldblog>oldblog</a></li></ul></div><div class=post-content><p><h1><a href id=jak_rozchodit_ltsp></a></h1><div class=level1>Dnes jsem měl za úkol rozchodit LTSP (Linux Terminal Server Project) a lokální mechaniky. Již samotné rozchození LTSP se neobešlo bez problémových partií. V <a class=urlextern href=http://wiki.ltsp.org/twiki/bin/view/Ltsp/Documentation rel=nofollow title=http://wiki.ltsp.org/twiki/bin/view/Ltsp/Documentation>dokumentaci</a> projektu je přesně popsáno, jak na to. V tomto zápisu vypíšu některé <em>špeky</em>, na kterých jsem se nachytal.<br></div><h2><a href id=instalace>Instalace</a></h2><div class=level2>Nejrve je třeba nainstalovat nějakou distribuci včetně X Window Systemu, dále nainstalovat balíčky ftfp-server, dhcp-server a nfs-server. Pokračuje to instalací ltsp-utils balíčku (k dispozici je malinké rpmko nebo tarball). Tento se z tarballu nainstaluje ne do /usr/local/sbin ale do /usr/sbin. Ale budiž, pak jej spustíte a pomocí pěkné nabídky nainstalujete ltsp do adresáře /opt.<br>Součástí je velmi pěkný konfigurační nástroj, se kterým nakonfigurujete všechny potřebné služby. Umí například aktivovat XDMCP pro přihlašovací obrazovku, aktivovat a nastavit služby TFTP, <acronym title="Dynamic  Host Configuration Protocol">DHCP</acronym> a NFS.<br></div><h2><a href id=konfigurace>Konfigurace</a></h2><div class=level2>Konfigurátor umí služby NFS a TFTP nakonfigurovat zcela sám (stačí mu zadat správné cesty), u <acronym title="Dynamic Host Configuration  Protocol">DHCP</acronym> už je to složitější. Nakopíruje tam ukázkovou konfiguraci, kterou musíte zeditovat a upravit. To by nebyl až takový problém, ale z mě nepochopitelného důvodu není součástí ukázkové konfigurace bootování po síti.<br>Bootovat po síti můžete buď inteláckým protokolem PXE, nebo Etherbootem (nebo jim podobným). První možnost má výhodu v tom, že nepotřebujete síťovou kartu flasnout. U PXE máte na výběr ze dvou možností: buď použijete PXELINUX (součást balíku SYSLINUX), nebo si můžete <a class=urlextern href=http://rom-o-matic.net/ rel=nofollow title=http://rom-o-matic.net>vygenerovat</a> PXE loader pro vaši síťovou kartu.<br><br>První způsob se mi nepodařilo rozchodit s kartou PCNET32, která je emulována ve VMWare. Problém byl ten, že karta špatně komunikovala s TFTP serverem. V diskuzích jsem se dočetl, že to má co do činění s velikostmi rámců ethernetu a protokolu tftp. Zkrátka končilo to na tom, že karta bootovala několik desítek minut (zprávy <strong>Trying to load</strong> se totiž několikrát opakují). Nakonec, když načetl konečně syslinux konfigurátor, tak nemohl najít jádro.<br><br>Druhý způsob už byl úspěšný, vygeneroval jsem si PXE boot loader pro danou síťovou kartu a musel jsem překopat konfiguraci <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> démona. Docela jsem s tím bojoval, protože můj PXE boot rom ignoroval nabídky na adresy, dokud nebyla dhcpd.conf uvedena volba <strong>next-server</strong>. Uvedu tedy funkční konfiguraci:<br><pre class=code>ignore client-updates;<br>ddns-update-style interim;<br>use-host-decl-names on;<br><br>allow booting;<br>allow bootp;<br>next-server 192.168.47.128;<br><br>default-lease-time 21600;<br>max-lease-time 21600;<br><br>option subnet-mask 255.255.255.0;<br>option broadcast-address 192.168.47.255;<br>option routers 192.168.47.128;<br>option domain-name-servers 192.168.47.128;<br>option domain-name "domena.net";<br>option log-servers 192.168.47.128;<br>option root-path "192.168.47.128:/opt/ltsp/i386";<br><br>subnet 192.168.47.0 netmask 255.255.255.0 {<br> range dynamic-bootp 192.168.47.100 192.168.47.200;<br>}<br><br>group {<br> if substring (option vendor-class-identifier, 0, 9) = "PXEClient" {<br>  filename "/pxe/eb-5.4.3-pcnet32.zpxe";<br> } else {<br>  filename "/lts/vmlinuz-2.6.17.8-ltsp-1";<br> }<br><br> host ws001 {<br>  hardware ethernet 00:0c:29:dd:5d:c1;<br>  fixed-address 192.168.47.90;<br> }<br>}</pre><br>Vysvětlivky:<br><ul><li class=level1><div class=li><strong>next-server</strong> – adresa se serverem, na kterém je umístěno jádro (shodné s <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>; bez této volby mi PXE boot rom nepřijímal znovu IP adresu)</div></li><li class=level1><div class=li><strong>root-path</strong> – adresa a cesta k rootu bezdiskové stanice</div></li><li class=level1><div class=li><strong>group</strong> – skupina hostů se specifickým nastavením (můžete vytvořit více skupin s různými verzemi jádra, PXE boot romy pro síťovky a podobně)</div></li><li class=level1><div class=li><strong>filename</strong> – soubor s PXE boot romem (první fáze bootu); soubor s linuxovým jádrem (druhá fáze bootu)</div></li><li class=level1><div class=li><strong>host</strong> – každý host musí být specifikován zvlášť a explicitně (jinak to opět nenabootuje)</div></li></ul></div><h2><a href id=lokalni_mechaniky>Lokální mechaniky</a></h2><div class=level2>Postupoval jsem přesně podle <a class=urlextern href=http://wiki.ltsp.org/twiki/bin/view/Ltsp/LTSP-42-LocalDev rel=nofollow title=http://wiki.ltsp.org/twiki/bin/view/Ltsp/LTSP-42-LocalDev>návodu</a>. Dále jen stručně:<br><ul><li class=level1><div class=li>Modul perl-X11-Protocol jsem nainstaloval ručně, protože mašina neměla v té době přístup na internet.</div></li><li class=level1><div class=li>Balíček ltsp-server-pkg-static jsem použil z tarballu, dal jsem jej do /usr/local/src a podle README vytvořil symlinky do /usr/sbin a /usr/bin.</div></li><li class=level1><div class=li>Jaderný modul fuse a fusetools z Mandrivy 2006 nebyly funkční (chyba <em>Illegal argument –</em>). Zkompiloval jsem aktuální verzi balíku fuse (2.6.7) ručně, make install nainstaloval fuse do /usr/local a jaderný modul jsem přejmenoval na fuse-compiled.ko, umístil do /lib/modules a spustil <code>depmod -a</code>.</div></li><li class=level1><div class=li>Podle manuálu jsem přes /etc/X11/init.d/ nechal spouštět na klientovi démona, který se stará o připojování, odpojování a posílání dat přes síť.</div></li><li class=level1><div class=li>Udev jsem nastavil tak, aby měl /dev/fuse práva 666.</div></li><li class=level1><div class=li>V Mandrivě nevím proč nemá uživatel v cestě PATH adresář /usr/local/bin, takže jsem musel vytvořit symlink /usr/bin/fusermount do /usr/local/bin.</div></li><li class=level1><div class=li>Je <strong>nutné</strong> zkontrolovat, zda je proměnná HOSTNAME na <em class=u>konzoli</em> (tj CTRL+ALT+F2) terminálu nastavena správně a shodně je také v Xech nastavena proměnná DISPLAY. Do terminálu se lze dostat jen v případě, že v lts.conf je nakonfigurován SCREEN_02 = shell.</div></li></ul></div><br><i>Tento zápisek vznikl převodem z mého starého blogu. Ne všechny texty byly takto převedeny, kompletní archiv již není k dispozici.</i></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>