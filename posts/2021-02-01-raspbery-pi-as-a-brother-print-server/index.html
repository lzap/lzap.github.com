<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Raspbery Pi as a Brother print server</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora"><meta property="og:url" content="http://blog.zapletalovi.com/posts/2021-02-01-raspbery-pi-as-a-brother-print-server/"><meta property="og:type" content="website"><meta property="og:title" content="Raspbery Pi as a Brother print server"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Raspbery Pi as a Brother print server"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="http://blog.zapletalovi.com/posts/2021-02-01-raspbery-pi-as-a-brother-print-server/"><meta property="twitter:url" content="http://blog.zapletalovi.com/posts/2021-02-01-raspbery-pi-as-a-brother-print-server/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=http://blog.zapletalovi.com/posts/2021-02-01-raspbery-pi-as-a-brother-print-server/><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=http://blog.zapletalovi.com/css/dark.css><script src=http://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=http://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=http://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://blog.zapletalovi.com><img src=http://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=http://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Raspbery Pi as a Brother print server</h1><small role=doc-subtitle></small><p class=post-date>February 1, 2021</p><ul class=post-tags><li class=post-tag><a href=http://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=http://blog.zapletalovi.com/tags/fedora>fedora</a></li></ul></div><div class=post-content><p><p>This is a tutorial on how to use Raspberry Pi as a print server. In my
case it&rsquo;s RPi 4 with Brother 7065DN.</p><p>The first step is to download a Raspbian image, I suggest the
&ldquo;headless&rdquo; image which does not have a graphical environment. In my
case, I downloaded a 64bit image which is still in alpha because I
wanted to be prepared for the future.</p><p>Write the image to a SD card, I am on Fedora Linux so I use dd command:</p><pre><code>dd if=2021-01-11-raspios-buster-armhf-lite.zip of=/dev/null status=progress bs%4096
</code></pre><p>Now, remove the SD card and put it back to mount it. Two new drives
will appear named &ldquo;boot&rdquo; and &ldquo;rootfs&rdquo;. Create a new file named
wpa_supplicant.conf on the boot volume if you want to use WiFi:</p><pre><code>ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=CZ
network={
 ssid=&quot;Internet_41&quot;
 psk=&quot;SecretPassword&quot;
}
</code></pre><p>Make sure to put the correct ISO country code (CZ in my case)
otherwise the 5Ghz band can be turned off due to regulatory
limitations.</p><p>Add another empty file called &ldquo;ssh&rdquo; which will make the service to be
automatically enabled during the first boot.</p><p>If you want to use DHCP, skip this step. Otherwise edit
/etc/dhcpd.conf in the rootfs volume:</p><pre><code>interface wlan0
static ip_address=10.0.0.130/24
static routers=10.0.0.138
static domain_name_servers=10.0.0.138
</code></pre><p>Unmount the SD card, insert it into your Raspberry, start it and
connect over SSH. The default username and password is: pi /
raspberry. First step, change the password. I suggest also to create a
new user, lock the pi one and configure ssh keys. If you choose to
create a brand new account, make sure it&rsquo;s in all supplementary groups
as the pi user, namely sudo group is important to have sudo access.
The minimum step is to set new password:</p><pre><code>passwd
</code></pre><p>Setup some reasonable hostname:</p><pre><code>hostnamectl set-hostname printer
</code></pre><p>Optional: Remove X Windows if you downloaded full image or used used
64bit alpha image which comes only with X:</p><pre><code>sudo systemctl set-default multi-user.target
sudo apt-get remove --auto-remove --purge 'libx11-.*'
sudo apt-get autoremove --purge
</code></pre><p>Now install the print server. I am lucky because my printer driver is
actually in printer-driver-brlaser package:</p><pre><code>sudo apt-get install cups printer-driver-brlaser foomatic-db-engine printer-driver-all openprinting-ppds hp-ppd
</code></pre><p>Optional: If you know your printer is not in Debian, install drivers
for your printer. Warning: Raspberry Pi is ARM architecture, most
vendors only provide intel drivers and very few do provide full source
codes for their filter programs. This is the breaking point, your
printer might not be supported on Raspberry.</p><p>Make sure the user account in use is in the lpadmin group:</p><pre><code>sudo usermod -a -G lpadmin pi
</code></pre><p>Modify the printer service to listen on the IP address instead of localhost:</p><pre><code>$ grep Listen /etc/cups/cupsd.conf
Listen 10.0.0.130:631
</code></pre><p>Put Allow All statements to all Location blocks:</p><pre><code>&lt;Location /&gt;
  Order allow,deny
  Allow All
&lt;/Location&gt;
</code></pre><p>When Pi is on a wifi network, it can take some time until the network
is brought up and CUPS can without a web interface. This helps to
mitigate this problem:</p><pre><code>$ sudo cat /etc/systemd/system/cups.service.d/override.conf
[Install]
WantedBy=default.target multi-user.target printer.target
[Service]
ExecStartPre=/bin/sleep 30
</code></pre><p>Reload the systemd service:</p><pre><code>sudo systemctl daemon-reload
</code></pre><p>And only NOW start the printing service:</p><pre><code>sudo systemctl enable --now cups
</code></pre><p>That&rsquo;s all. You should be able to print from Linux, ChromeOS, MacOS,
iOS and Android. The only OS I haven&rsquo;t tested is Windows.</p><p>As a bonus I am giving you quick few commands to setup file sharing
which is a handy thing to have in a household:</p><pre><code>sudo apt-get install samba cifs-utils
sudo chmod 777 /mnt/data

$ cat /etc/samba/smb.conf
[global]
netbios name = Printer
server string = Printer
[public]
comment = My USB drive
path = /mnt/data
public = yes
writable = yes
create mask = 0777
directory mask = 0777
force user = nobody
force group = nogroup
</code></pre><p>Now start the Samba services:</p><pre><code>sudo systemctl enable --now smbd nmbd
</code></pre><p>Note that you do NOT need to run Samba in order to print from most
operating systems, laptops of phones. However if you will not be able
to print from Windows, it&rsquo;s possible that Samba needs to be configured
and printing must be enabled. Follow <a href=https://wiki.debian.org/SystemPrinting#CUPS_and_Samba>some
instructions</a>
in order to do that.</p><p>Have fun!</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>