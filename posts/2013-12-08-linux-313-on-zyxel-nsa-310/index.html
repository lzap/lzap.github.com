<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Linux 3.13+ on Zyxel NSA 310</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2013-12-08-linux-313-on-zyxel-nsa-310/"><meta property="og:type" content="website"><meta property="og:title" content="Linux 3.13+ on Zyxel NSA 310"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Linux 3.13+ on Zyxel NSA 310"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2013-12-08-linux-313-on-zyxel-nsa-310/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2013-12-08-linux-313-on-zyxel-nsa-310/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2013-12-08-linux-313-on-zyxel-nsa-310/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Linux 3.13+ on Zyxel NSA 310</h1><small role=doc-subtitle></small><p class=post-date>December 8, 2013</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/fedora>fedora</a></li></ul></div><div class=post-content><p><p>I have already written <a href=/2013/03/booting-38-kernels-on-marwell-kirkwood-arm-zyxel-nsa-310.html>an
article</a>
about this Marwell Kirkwood device. This time, we are going to compile <em>Linus
tree kernel</em>. Yes, almost everything have been already merged. Except LEDs.</p><p>It&rsquo;s super easy now.</p><pre><code># make mrproper
# make kirkwood_defconfig
</code></pre><p>Creates clean and minimal setup for Kirwkood devices. I needed to make two
changes - u-Boot on my device is old and does not support DTS enabled kernels,
so I had to concatenate it. Also, for some reason the kernel was ignoring my
command line, so I burnt it into the kernel image itself.</p><pre><code># grep CMDLINE .config
CONFIG_CMDLINE=&quot;console=ttyS0,115200 root=/dev/sda3&quot;
</code></pre><p>For your case, keep the console setting, but adjust our root to the proper
device. If you know why the kernel was not picking up my command line (I was
using 3.13 RC2), let me know under the article. If you need to change
configuration and add more drivers, it&rsquo;s the time now (e.g. USB WiFi sticks,
printers etc.)</p><pre><code># make menuconfig
</code></pre><p>I usually write the configuration now and edit it via editor from now on which
is faster. Let&rsquo;s do the kernel now.</p><pre><code># make &amp;&amp; make dtbs
</code></pre><p>Or if you selected some modules, do this instead:</p><pre><code># make &amp;&amp; make dtbs &amp;&amp; make modules &amp;&amp; make modules_install
</code></pre><p>The final step is very important - we need to make an uImage with concatenated
device tree for our NSA 310.</p><pre><code># cat arch/arm/boot/zImage arch/arm/boot/dts/kirkwood-nsa310.dtb \
    &gt; /tmp/zImage-dtb-kirwood
# mkimage -A arm -O linux -T kernel -C none -a 0x00008000 -e 0x00008000 \
    -n Linux-kikrwood-nsa310.dtb -d /tmp/zImage-dtb-kirwood \
    /boot/uImage-3.13.0-rc2
</code></pre><p>Note there are two files:</p><ul><li>arch/arm/boot/dts/kirkwood-nsa310.dtb</li><li>arch/arm/boot/dts/kirkwood-nsa310a.dtb</li></ul><p>Because there are more hardware versions, try out both and find which one
works best for you.</p><p>Boot the new kernel and note that <em>everything works</em>, except LEDs. Also the
power button is working, which is great. I don&rsquo;t need LEDs, actually I don&rsquo;t
like blinking LEDs at all so I am fine. If you <em>need</em> LEDs, there are couple
of patches on the arm-list floating around - grab them.</p><p>I have created an ultra <a href=https://github.com/lzap/fan3xxnsa>simple script</a>
which controls the fan. There are other ways of doing that (e.g. via
lm-sensors), but I prefer this lightweight solution (written in Go).</p><p>In my house, NSA 310 is great cheap 2 TB NAS, file server, print server,
backup server and WiFi AP ($10 Tenda USB stick - was working out-of-box).</p><p>Drop me a line in the comments bellow!</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>