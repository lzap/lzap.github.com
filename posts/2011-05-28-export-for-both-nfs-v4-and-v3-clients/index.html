<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Export for both NFS v4 and v3 clients under RHEL 6</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,nfsv3,rhel6,nvsv4,nfs"><meta property="og:url" content="https://blog.zapletalovi.com/posts/2011-05-28-export-for-both-nfs-v4-and-v3-clients/"><meta property="og:type" content="website"><meta property="og:title" content="Export for both NFS v4 and v3 clients under RHEL 6"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Export for both NFS v4 and v3 clients under RHEL 6"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="https://blog.zapletalovi.com/posts/2011-05-28-export-for-both-nfs-v4-and-v3-clients/"><meta property="twitter:url" content="https://blog.zapletalovi.com/posts/2011-05-28-export-for-both-nfs-v4-and-v3-clients/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=https://blog.zapletalovi.com/posts/2011-05-28-export-for-both-nfs-v4-and-v3-clients/><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://blog.zapletalovi.com/css/dark.css><script src=https://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=https://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=https://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.zapletalovi.com><img src=https://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=https://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=https://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=https://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=https://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Export for both NFS v4 and v3 clients under RHEL 6</h1><small role=doc-subtitle></small><p class=post-date>May 28, 2011</p><ul class=post-tags><li class=post-tag><a href=https://blog.zapletalovi.com/tags/nfsv3>nfsv3</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/rhel6>rhel6</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/nvsv4>nvsv4</a></li><li class=post-tag><a href=https://blog.zapletalovi.com/tags/nfs>nfs</a></li></ul></div><div class=post-content><p>One of the new features in RHEL 6 is NFS version 4. It has a different concept and some administrators can be confused. I highly recommend to read RHEL 6 Storage Administration Guide or other documents related to NFSv4.<br><br>The key change in NFSv4 is the concept of the root directory. To get things working for both v4 and v3 clients the most recommended way is to remount everything under one directory (we will create /exports for that). New clients will use relative paths and old clients full paths.<br><br>In my example I am exporting /mnt/data directory, thus I am creating /exports directory with data directory in it, binding it there and configuring nfs and firewall.<br><br><i># mkdir /mnt/data</i><br><i># mkdir -p /exports/data</i><br><i><br></i><br><i># cat /etc/fstab | grep data</i><br><i>/mnt/data /exports/data none bind</i><br><i><br></i><br><i># mount -a</i><br><i><br></i><br><i># cat /etc/exports</i><br><pre><i>/exports *(ro,async,no_subtree_check,insecure,fsid=0)<br>/exports/data 192.168.1.0/24(ro,sync,insecure,no_subtree_check,nohide)</i></pre><br>Now it's the time to configure firewall. Uncomment all the lines here:<br><br><i># grep -v '^#' /etc/sysconfig/nfs</i><br><i>LOCKD_TCPPORT=32803</i><br><i>LOCKD_UDPPORT=32769</i><br><i>RQUOTAD_PORT=875</i><br><i>MOUNTD_PORT=892</i><br><i>STATD_PORT=662</i><br><br>And add all the ports to the firewall config (tcp, udp, tcp, tcp in this order). Open portmapper tcp port 111 as well. You can use GUI/TUI for that, but I prefer config file edit:<br><br><i># sudo grep -E '\s(32803|32769|892|662|111)\s' /etc/sysconfig/iptables</i><br><i>-A INPUT -m state --state NEW -m tcp -p tcp --dport 111 -j ACCEPT</i><br><i>-A INPUT -m state --state NEW -m tcp -p tcp --dport 892 -j ACCEPT</i><br><i>-A INPUT -m state --state NEW -m tcp -p tcp --dport 875 -j ACCEPT</i><br><i>-A INPUT -m state --state NEW -m tcp -p tcp --dport 662 -j ACCEPT</i><br><i>-A INPUT -m state --state NEW -m tcp -p tcp --dport 32803 -j ACCEPT</i><br><i>-A INPUT -m state --state NEW -m udp -p udp --dport 32769 -j ACCEPT</i><br><br><b>Now, this is important</b>. Do not restart nfs using simple "restart" command. First of all bring all the services down:<br><br><i># service nfs stop</i><br><i>#&nbsp;service nfslock&nbsp;stop</i><br><i>#&nbsp;service rpcbind&nbsp;sto</i>p<br><br>Now, restart iptables and bring all NFS services up in the following order.<br><br><i>#&nbsp;service iptables restart</i><br><br><i>#&nbsp;service rpcbind start</i><br><br><i>#&nbsp;service nfslock start</i><br><i># service nfs start</i><br><div><br></div><br><br>This is important because when you do "restart", nfs is usually running already by default and it won't show all errors. Make sure nfs, nfslock and rpcbind services are enabled after boot.<br><br><i># chkconfig nfs on</i><br><br><i># chkconfig nfslock on</i><br><i># chkconfig rpcbind on</i><br><br><br>Test it:<br><br><i># showmount -e localhost</i><br><br>We are almost there.&nbsp;NFSv4 clients must connect with relative address:<br><br><i># sudo mount -t nfs -o vers=4 server:/data /tmp/my/directory</i><br><br>NFSv3 clients must use full address:<br><br><i># sudo mount -t nfs -o vers=3 server:/exports/data /tmp/my/directory</i><br><br>Thank to our remount we are able to export any directory within the server.</p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>