<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Samba and NFS shared folder on CentOS 8</title><meta name=description content="engineer in pyjama"><meta name=keywords content="blog,lzap,lukáš,zapletal,linux,tech,fedora"><meta property="og:url" content="http://blog.zapletalovi.com/posts/2020-01-11-samba-and-nfs-shared-folder-on-centos8/"><meta property="og:type" content="website"><meta property="og:title" content="Samba and NFS shared folder on CentOS 8"><meta property="og:description" content="engineer in pyjama"><meta property="og:image" content="/images/avatar_rh_512.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Samba and NFS shared folder on CentOS 8"><meta name=twitter:description content="engineer in pyjama"><meta property="twitter:domain" content="http://blog.zapletalovi.com/posts/2020-01-11-samba-and-nfs-shared-folder-on-centos8/"><meta property="twitter:url" content="http://blog.zapletalovi.com/posts/2020-01-11-samba-and-nfs-shared-folder-on-centos8/"><meta name=twitter:image content="/images/avatar_rh_512.jpg"><link rel=canonical href=http://blog.zapletalovi.com/posts/2020-01-11-samba-and-nfs-shared-folder-on-centos8/><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=http://blog.zapletalovi.com/css/main.css><link disabled id=dark-theme rel=stylesheet href=http://blog.zapletalovi.com/css/dark.css><script src=http://blog.zapletalovi.com/js/svg-injector.min.js></script>
<script src=http://blog.zapletalovi.com/js/feather-icons.min.js></script>
<script src=http://blog.zapletalovi.com/js/main.js></script>
<script type=text/javascript>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-16034952-1"]),_gaq.push(["_trackPageview"]),function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=http://blog.zapletalovi.com><img src=http://blog.zapletalovi.com/images/avatar_rh_512.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=http://blog.zapletalovi.com>Lukáš Zapletal</a></div><div class=nav-links><div class=nav-link><a href=http://blog.zapletalovi.com/posts/>Posts</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/me/>About me</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/contact/>Contact</a></div><div class=nav-link><a href=http://blog.zapletalovi.com/tags/>Tags</a></div><div class=nav-link><a href=https://github.com/lzap><span data-feather=github></span></a></div><div class=nav-link><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></div><div class=nav-link><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></div><div class=nav-link><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></div><div class=nav-link><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=http://blog.zapletalovi.com/posts/>Posts</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/me/>About me</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/contact/>Contact</a></li><li class=nav-item><a href=http://blog.zapletalovi.com/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/lzap><span data-feather=github></span></a></li><li class=nav-item><a href=https://mastodon.social/@lzap><img class=svg-inject src=/svg/icons/mastodon.svg></a></li><li class=nav-item><a href=https://twitter.com/lzap><span data-feather=twitter></span></a></li><li class=nav-item><a href=https://www.buymeacoffee.com/lzap><span data-feather=coffee></span></a></li><li class=nav-item><a href=http://blog.zapletalovi.com/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Samba and NFS shared folder on CentOS 8</h1><small role=doc-subtitle></small><p class=post-date>January 11, 2020</p><ul class=post-tags><li class=post-tag><a href=http://blog.zapletalovi.com/tags/linux>linux</a></li><li class=post-tag><a href=http://blog.zapletalovi.com/tags/fedora>fedora</a></li></ul></div><div class=post-content><p><p>Setting up a shared (guest) read-write folder across Samba and NFS was a piece
of cake on CentOS 8. I&rsquo;ve also thrown Avahi daemon into the mix so all three
platforms we have in our family can easily access our data. Here are my notes.</p><p>First of, I&rsquo;ve put my ethernet into trusted zone because I don&rsquo;t want to deal
with firewall in my home network. I am running one on router. You should
probably not do this.</p><pre><code>firewall-cmd --zone=trusted --change-interface=eno1
firewall-cmd --zone=trusted --change-interface=eno1 --permanent
</code></pre><p>For the record, my new NAS server is simply an 8th gen Intel NUC with a SSD for
the OS and 2 TB Seagate drive for data. I don&rsquo;t have much content just photos
basically, unfortunately the bay is 9mm and there are no bigger 2.5-sized disks
available. My plan is to extend it later with an external 4-6 TB USB3 or
Thunderbolt HDD. I&rsquo;ve configured LVM and the internal drive is mounted at
<code>/mnt/int</code>. I don&rsquo;t use RAID on my home NAS servers because I believe it&rsquo;s not
necessary - I can live with couple of days downtime until new disk arrives.
Remember: RAID is not a backup! I regularly backup all the data to a remote
location.</p><p>Overall goal is simple: have a single shared folder between Samba and NFS
mounted read-write with SELinux turned on with minimum configuration as
possible.</p><p>I&rsquo;ve installed Samba, NFS server, SELinux utilities and Avahi daemon:</p><pre><code>dnf install samba samba-client nfs-utils policycoreutils-python-utils avahi
</code></pre><p>Configuration of Samba could have been more simple as many of these values are
probably default ones, I was just experimenting a bit and it won&rsquo;t hurt for
sure. This is /etc/samba/smb.conf:</p><pre><code>[global]
    netbios name = NUC
    workgroup = WORKGROUP
    local master = yes
    security = user
    passdb backend = tdbsam
    guest account = nobody
    map to guest = Bad User
    logging = systemd
    log level = 0
    load printers = no

[data]
    comment = Data
    path = /mnt/int/data
    browseable = yes
    writeable = yes
    public = yes
    read only = no
    guest ok = yes
    guest only = yes
    force create mode = 0664
    force directory mode = 0775
    force user = nobody
    force group = nobody
</code></pre><p>The important SELinux &ldquo;trick&rdquo; was to configure file context correctly, so both
NFS and Samba can access read and write it:</p><pre><code>semanage fcontext -a -t public_content_rw_t &quot;/mnt/int(/.*)?&quot;
restorecon -RvvF /mnt/int
</code></pre><p>Both services also need to be allowed to write content:</p><pre><code>setsebool -P allow_smbd_anon_write=1
setsebool -P allow_nfsd_anon_write=1
</code></pre><p>Configuration of NFSv4 in RHEL 8 (CentOS 8) is super easy. If you remember the
pain of configuring firewalls with with older NFS versions like me, you want to
disable those services completely. This step is optional if you want to allow
legacy NFS clients:</p><pre><code>/etc/nfs.conf:
[nfsd]
vers2=no
vers3=no
</code></pre><p>Stop and disable NFS services which are not needed for NFSv4:</p><pre><code>systemctl mask --now rpc-statd.service rpcbind.service rpcbind.socket
</code></pre><p>End of the optional step. Configuration of NFS server is super easy (compare to
Samba):</p><pre><code>/etc/exports:
/mnt/int/data *(rw,async,all_squash,anonuid=65534,anongid=65534)
</code></pre><p>Since NFS server comes preinstalled in the default server CentOS8 installation
profile, I restarted it.</p><pre><code>systemctl restart nfs-server
</code></pre><p>And enabled Samba and Avahi services:</p><pre><code>systemctl enable --now nmb.service smb.service nfs-server.service avahi-daemon.service
</code></pre><p>That&rsquo;s really all. Testing is easy, install <code>samba-client</code> package and do:</p><pre><code>smbclient -U guest //nuc/data
</code></pre><p>To test NFS, just mount the directory:</p><pre><code>mount -t nfs nuc:/mnt/int/data /mnt/nuc
</code></pre><p>Hope the article helped you to achieve shared folder at home. This is not
recommended setup for work or coffeeshops. And remember to do regular backups
(not copies), because people can accidentaly rename, overwrite or delete files!</p><p>Drop me a comment or share via Twitter please. Have a good one.</p></p></div></div></main><footer class=footer><span>&copy; 2022 Lukáš Zapletal, CC BY 4.0</span>
<span>Built with <a href=https://gohugo.io>hugo</a>, template <a target=_blank href=https://github.com/526avijitgupta/gokarna>gokarna</a></span></footer></body></html>