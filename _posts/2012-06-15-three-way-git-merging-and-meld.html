---
layout: post
title: Three-way git merging and meld
date: 2012-06-15
tags:
- vim
- git
---

<h1>{{ page.title }}</h1>
Although I am vim-lover, when it comes to git merging I use excellent tool called <a href="http://meldmerge.org/">Meld</a>&nbsp;sometimes. It's a GTK-based application written in Python and it has very nice capabilities of showing diffs. Particularly, I like how Meld shows changes on the same lines (highlighing portions of them), it's editable text pane with source highlighting and ability to visually merge conflicts using arrow icons.<br /><br />But there is a <b>snag</b>.<br /><br />I don't consider Meld as a three-way merging tool, even the authors state this on the features page. Many people tend to thing that diff tool with two panes can be considered two-way and tool with three panes as three-way. That's not the case.<br /><br />Basic idea of three-way merging is taking third merging source into the loop, so instead traditional LOCAL and REMOTE (or MINE and THEIRS if you like) there is additional one: BASE. That's the parent for both commits in git. Still don't see the drawback?<br /><br />For manual three-way merging you need four panes, because you want to see LOCAL, REMOTE, BASE and also the file you will be actually merging. In the git case, that would be:<br /><br /><i>test.txt</i><br /><i>test.txt.LOCAL</i><br /><i>test.txt.REMOTE</i><br /><i>test.txt.BASE</i><br /><br />Typical three-way merging tool shows differences between LOCAL, BASE and REMOTE on the top while offering one additional text pane on the bottom. For example, vimdiff can do this four-pane merging with a little tuning (you need to move merged buffer window to the bottom of the screen). Another great example of this approach is Perforce (p4merge).<br /><br />Please note workflow is a bit different than in three-pane merging tools - you usually don't touch the file in the middle (BASE) and edit the bottom (merged) file manually. At least I don't know any tool that would offer you visual merging of blocks from LOCAL, BASE or REMOTE panes, except vim getdiff and putdiff capabilities. But that is not visual.<br /><br />If you start three-pane merging tool (e.g. meld, kdiff3 and most of the others), you usually see LOCAL, merging file and REMOTE. What you don't see is BASE file, how it looked like before it was changed in any way.<br /><br />Fortunately Meld supports tabs, so you can still see something. I configured my git to start three tabs in Meld. On the first one I see differences between BASE and LOCAL. On the second one I see BASE and REMOTE. And the third one is usual: LOCAL, merged file, REMOTE. The configuration is pretty easy:<br /><br /><i>[merge]</i><br /><i>tool = mymeld</i><br /><i>conflictstyle = diff3</i><br /><i>[mergetool "mymeld"]</i><br /><i>cmd = meld --diff $BASE $LOCAL --diff $BASE $REMOTE --diff $LOCAL $MERGED $REMOTE</i><br /><br />You don't even need to set conflict style to "diff3" if you dont like to see "merged common ancestors" in the conflict block, but I like to see it there. This line is optional thus. And how does it look like? The first tab shows the changes in the branch I am merging into (e.g. "master"):<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-77fjyPflhZ0/T9sXjPziE2I/AAAAAAAAAds/6gMyFSzu4qw/s1600/meld1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="135" src="http://2.bp.blogspot.com/-77fjyPflhZ0/T9sXjPziE2I/AAAAAAAAAds/6gMyFSzu4qw/s320/meld1.png" width="320" /></a></div><br />The second is similar, shows changes from the branch I am merging (e.g. "feature" branch):<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-SUfYavTLcnk/T9sXj9xnd4I/AAAAAAAAAdw/DLV4z6I7fTY/s1600/meld2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="135" src="http://3.bp.blogspot.com/-SUfYavTLcnk/T9sXj9xnd4I/AAAAAAAAAdw/DLV4z6I7fTY/s320/meld2.png" width="320" /></a></div><br />And the third (opened by default) has traditional three-pane layout where I do the work.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-B4jgOEaACsM/T9sXkzSdLsI/AAAAAAAAAd4/feHpHnz_VkI/s1600/meld3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="135" src="http://2.bp.blogspot.com/-B4jgOEaACsM/T9sXkzSdLsI/AAAAAAAAAd4/feHpHnz_VkI/s320/meld3.png" width="320" /></a></div><br />That's all for today.