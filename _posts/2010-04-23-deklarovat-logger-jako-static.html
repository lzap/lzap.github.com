---
layout: post
title: Deklarovat logger jako static?
date: 2010-04-23
tags:
- oldblog
---

<h1>{{ page.title }}</h1>
<i><span class="Apple-style-span" style="font-style: normal;"></span></i><br /><i><h1><span class="Apple-style-span" style="font-size: medium; font-weight: normal;"><i><span class="Apple-style-span" style="font-style: normal;"><div class="level1" style="display: inline !important;"><div style="display: inline !important;">Často se sám sebe na začátku každého projektu zeptám –&nbsp;<em>budu deklarovat loggery jako statické</em>? Jinak řečeno, budou začátky tříd vypadat takto:</div></div></span></i></span></h1><div class="level1"><pre class="code java"><span class="kw1">public</span> <span class="kw1">class</span> Foo <span class="br0">{</span><br />  <span class="kw1">private</span> <span class="kw1">static</span> <span class="kw1">final</span> Log log <span class="sy0">=</span> LogFactory.<span class="me1">getLog</span><span class="br0">(</span>Foo.<span class="kw1">class</span><span class="br0">)</span><span class="sy0">;</span><br />  ....<br /><span class="br0">}</span></pre>A nebo takto:<br /><pre class="code java"><span class="kw1">public</span> <span class="kw1">class</span> Foo <span class="br0">{</span><br />  <span class="kw1">private</span> <span class="kw1">final</span> Log log <span class="sy0">=</span> LogFactory.<span class="me1">getLog</span><span class="br0">(</span>Foo.<span class="kw1">class</span><span class="br0">)</span><span class="sy0">;</span><br />  ....<br /><span class="br0">}</span></pre><pre class="code java"><span class="br0"><br /></span></pre><pre class="code java"><span class="Apple-style-span" style="font-family: 'Times New Roman'; white-space: normal;"><i><span class="Apple-style-span" style="font-style: normal;"><div class="level1" style="display: inline !important;"><div style="display: inline !important;">Oba přístupy mají svá pro i proti.</div></div></span></i></span></pre><pre class="code java"><span class="Apple-style-span" style="font-family: 'Times New Roman'; white-space: normal;"><i><span class="Apple-style-span" style="font-style: normal;"><div class="level1" style="display: inline !important;"><div style="display: inline !important;"><br /></div></div></span></i></span></pre>V&nbsp;<strong>prvním případě</strong>&nbsp;(statickém) je pro menší využití paměti a program bude o něco rychlejší – není třeba pro každou instanci vytvářet logger. Také nebývá problém při serializaci, kdy načtená třída bez problémů funguje. Ovšem do problému se můžeme dostat, pakliže máme logovací knihovny v J2EE serveru umístěny ve sdíleném prostoru (classloaderu) a na serveru je více instancí stejné aplikace nebo knihovny, které logují. Pak nebude možné od sebe odlišit jednotlivé instance, takže kdybyste chtěli mít logy z jedné aplikace v jiném souboru, než logy z druhé, tak to nebude možné. Situaci musíte řešit na aplikační úrovni.<br /><br /><strong>Druhý případ</strong>&nbsp;(nestatický – instanční) tímto problémem netrpí a navíc se s ním lépe pracuje v IoC. Ale pozor – problém s classloaderem je vyřešen pouze v knihovných logback a log4j – nejnovějších verzích. Pokud používáte jinou logovací knihovnu (jul), máte smůlu a můžete použít static. Ovšem přístup má i nevýhody: situaci je třeba explicitně řešit při deserializaci (readResolve), a tento přístup je také pomalejší a bere více procesorového času.<br /><br />Takže&nbsp;<strong>rada zní</strong>: pokud jste si opravdu jisti, ale tím myslím na sto procent jisti, že aplikace nebude provozována ve více instancích na stejném aplikačním serveru, tak&nbsp;<strong>přesto</strong>&nbsp;používejte instanční (pomalejší) přístup. No – teď si dělám srandu. Pochopitelně, že můžete použít statický přístup. Ten instanční použijte jen tehdy, kdy máte jako logující implementaci novější verze knihoven log4j nebo logback (to je nástupce log4j).<br /><br /><strong>Druhá rada</strong>&nbsp;je pak prostá:&nbsp;<em>snažte se</em>&nbsp;o jednotný přístup.<br /><br />A konečně&nbsp;<strong>třetí rada</strong>: využijte svoje programovací prostředí naplno. Většina IDE nabízí možnost vytvoření šablony pro novou třídu, což lze využít pro&nbsp;<a class="wikilink1" href="file:///C:/Documents%20and%20Settings/lzapletal/My%20Documents/Download/oldblog/oldblog/blog/sikovne_sablony_pro_eclipse.html" title="blog:sikovne_sablony_pro_eclipse">nadefinování loggeru</a>&nbsp;i jiným věcem.<br />Mimochodem, když už se rozhodnete pro instance, pak lze zápis „zkrášlit“ voláním metody getClass() – tím pádem nemusíte logger upravovat, když děláte copy&amp;paste. A ruku na srdce – to děláte často, že?<br /><br /><pre class="code java"><span class="kw1">public</span> <span class="kw1">class</span> Foo <span class="br0">{</span><br />  <span class="kw1">private</span> <span class="kw1">final</span> Log log <span class="sy0">=</span> LogFactory.<span class="me1">getLog</span><span class="br0">(</span>getClass<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br />  ....<br /><span class="br0">}</span></pre><pre class="code java"><span class="br0"><br /></span></pre>U všech případů platí, že je vhodné deklarovat logger jako privátní. Pokud bychom totiž umožnili potomkům přístup na logger, mohlo by se stát, že by se v logu objevovaly zprávy potomků pod identifikátorem (názvem třídy) předka. Obecně platí jedno pravidlo –&nbsp;<strong>nikdy nepoužívejte logger předka</strong>. Za každých okolností musí mít každá třída svůj logger, leda byste měli vystavěný nějaký aparát, který by dodával správné identifikátory.<br /><br /><em>Pozn.: Původně jsem klíčové slovo private chybně neuváděl. Je potřeba jej ale z výše uvedených důvodů uvést. Díky za upozornění v diskusi.</em><br /><em><br /></em><br /><br /><br /><div class="notetip">Uvedené příklady jsou pro knihovnu-fasádu commons-logging, v ostatních případech (fasáda slf4j, knihovny log4j, logback, juli a další) bude kód vypadat trošičku jinak, a to jen v některých případech.</div><div class="notetip"><br /></div><br /><br />A poslední dodatek se týká klíčového slova&nbsp;<strong>final</strong>. Můžete jej uvádět vždy, když nebudete logger modifikovat (drtivá většina případů), může to pomoct kompilátoru/virtuálnímu stroji. Případ, kdy není vhodné slovo final uvést, již byl uveden výše – například při deserializaci a implementaci metody readResolve().<br /><br /><strong>Další zdroje</strong><br /><ul><li class="level1"><div class="li"><a class="urlextern" href="http://wiki.apache.org/jakarta-commons/Logging/StaticLog" rel="nofollow" title="http://wiki.apache.org/jakarta-commons/Logging/StaticLog">http://wiki.apache.org/jakarta-commons/Logging/StaticLog</a></div></li><li class="level1"><div class="li"><a class="urlextern" href="http://www.slf4j.org/faq.html#declared_static" rel="nofollow" title="http://www.slf4j.org/faq.html#declared_static">http://www.slf4j.org/faq.html#declared_static</a></div></li></ul></div></i><br /><i><br /></i><br /><i>Tento zápisek vznikl převodem z mého starého blogu. Ne všechny texty byly takto převedeny, kompletní archiv najdete v <a href="http://static.zapletalovi.com/oldblog">HTML archivu</a>.</i>