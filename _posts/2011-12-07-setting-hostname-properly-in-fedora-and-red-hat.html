---
layout: post
title: Setting hostname properly in Fedora and Red Hat
date: 2011-12-07
tags:
- hostname
- fedora
- rhel
---

<h1>{{ page.title }}</h1>
<p>I have been playing with hostnames yesterday and I had to stop for a while today doing a little research. Setting up a hostname is not a hard task, in Fedora and Red Hat it's a matter of editing one file:</p> <pre><code># grep HOSTNAME /etc/sysconfig/network<br />HOSTNAME=test.lan<br /></code></pre> <p>Here you set the whole FQDN. If you ever seen entries like DOMAINNAME in this file, they are wrong for Fedora or RHEL. If you want to change hostname without rebooting few steps are necessary:</p> <pre><code># hostname test.lan<br /># service network restart<br /></code></pre> <p>I skipped one simple, yet important step - setting <em>/etc/hosts</em>. It differs for situations when you use DHCP or not.</p> <p><strong>Clients with DHCP</strong></p> <p>With properly configured DHCP server, hostname should be propagated or defined by network administrator, there is no need of adding hostname to the <em>/etc/hosts</em>. For clients, it is really not necessary. Trust me. Keep only localhost there, walk your dog, enjoy life.</p> <p><strong>Servers with static IP</strong></p> <p>This is totally different scenario - server with static IP address must have entry in the <em>/etc/hosts</em> file in the following format (assuming a random class C address):</p> <pre><code># grep test /etc/hosts<br />192.168.1.1 test.lan test<br /></code></pre> <p>Please note the order matters. You must keep the following order: <em>ipaddress fqdn hostname</em>. I recommend to do a check-up after adding entries:</p> <pre><code># hostname <br />test.lan<br /># hostname -s<br />test<br /># hostname -f<br />test.lan<br /></code></pre> <p>With the incorrect order you will see <em>hostname -f</em> returning non-fully qualified response:</p> <pre><code># grep test /etc/hosts<br />192.168.1.1 test test.lan # incorrect order<br /># hostname -f<br />test<br /></code></pre> <p>The key for this behavior is in the manual page of hostname command:</p> <p>The function gethostname(2) is used to get the hostname.  When the hostname -a,  -d, -f or -i is called will gethostbyname(3) be called.  The difference in gethostname(2) and gethostbyname(3) is that  gethostbyname(3)  is  network aware,  so  it  consults /etc/nsswitch.conf  and  /etc/host.conf  to  decide whether  to  read information in /etc/sysconfig/network or /etc/hosts.</p> <p><strong>Servers with DHCP</strong></p> <p>Wait a minute! A server without static IP address? Does it make sense? Well, in the cloud it is not unusual to provision servers configured with DHCP. But cloud providers usually allow customers to reserve IPs for a while so it does not change. If this is your case, I recommend to stick with the <em>servers with static IP</em> rule. If the IP address changes rapidly, I would recomment <em>clients with DHCP</em> rule, but make sure hostname command returns correct answers for both -s and -f options, as seen above.</p> <p>In the latter case, contact your cloud provider asking how to set up hostname properly. Sometimes in testing environments servers with IPs delivered by DHCP servers do not have proper DNS setup. And you can have a service that insists on having hostname resolved. In this case, only in this case, I would recommend adding loop back hostname entry:</p> <pre><code># grep test /etc/hosts<br />127.0.0.1 test.lan test<br /></code></pre> <p>Again, keep the right order and make sure it does not mess up services on that box. Be prepared to see "Cannot determine hostname" warning when starting Apache for example.</p>