---
layout: post
title: Opakované kompilace s GWT v Antu
date: 2010-07-29
tags:

---

<h1>{{ page.title }}</h1>
U jedhoho projektu často provádíme rekompilaci jednotlivých komponent (release build). Jednou z těch komponent je uživatelské rozhraní psané v GWT (Google Web Toolkit). Ten je u produkční kompilace nesmírně pomalý, to je známá věc. Kompilační skripty máme psané v Antu.<br /><br />Jenže zdrojové kódy GWT aplikace se tak často nemění, proto jsem přemýšlel, jak opakované kompilaci zabránit. Je to snadné - stačí použít Ant task uptodate, který dokáže zkontrolovat, zda má soubor (či skupina souborů) starší datum změny, než jiný soubor. V mém případě to byla skupina souborů *.java vůči souboru WAR, který je výsledným artefaktem sestavovacího skriptu.<br /><br />Stačilo tedy u pravit antí cíl "gwtc" tak, aby se nejdříve provedla kontrola pomocí uptodate. Cíl gwtc je volán pouze v případě, že určitá proměnná není nastavena (gwtc-build-not-needed). Vypadá to asi nějak takto:<br /><br /><pre  style="font-family:arial;font-size:12px;border:1px dashed #CCCCCC;width:99%;height:auto;overflow:auto;background:#f0f0f0;;background-image:URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif);padding:0px;color:#000000;text-align:left;line-height:20px;"><code style="color:#000000;word-wrap:normal;">1:    &lt;target name="gwtc-uptodate" depends="javac" description="Check if GWTC is really needed"&gt;  <br />2:      &lt;uptodate property="gwtc-build-not-needed" targetfile="${dist}/clan-ui-${DSTAMP}.war"&gt;  <br />3:        &lt;srcfiles dir="${src-java}" includes="**/*" /&gt;  <br />4:      &lt;/uptodate&gt;  <br />5:    &lt;/target&gt;  <br />6:    &lt;target name="gwtc" depends="javac,gwtc-uptodate" description="GWT compile to JavaScript" unless="gwtc-build-not-needed"&gt;  <br />7:      &lt;java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler"&gt;  <br />8:        &lt;classpath&gt;  <br />9:          &lt;path refid="classpath" /&gt;  <br />10:          &lt;fileset dir="${src-java}"&gt;  <br />11:            &lt;include name="**/${project.name}.gwt.xml" /&gt;  <br />12:          &lt;/fileset&gt;  <br />13:        &lt;/classpath&gt;  <br />14:        &lt;arg value="${module.name}" /&gt;  <br />15:      &lt;/java&gt;  <br />16:    &lt;/target&gt;  <br /></code></pre><br />Mimochodem zdrojový kód tohoto příspěvku jsem naformátoval šikovnou <a href="http://codeformatter.blogspot.com/2009/06/about-code-formatter.html">utilitkou on-line</a>. Je velká škoda, že Blogger nenabízí žádnou komponentu pro formátování zdrojáků a příkazů.