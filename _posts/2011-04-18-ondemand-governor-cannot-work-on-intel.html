---
layout: post
title: Ondemand governor cannot work on Intel Atom D4x0 and D5x0
date: 2011-04-18
tags:
- atom
- rhel
- hw
---

<h1>{{ page.title }}</h1>
To my surprise my Intel Atom D410 with max. TDP 10W <a href="http://ark.intel.com/Product.aspx?id=43517">does not feature</a> Enhanced Intel SpeedStep technology. The linux kernel reports <i>ondemand</i>, <i>conservative</i> and <i>performance</i> governors, but I am not able to set any of these.<br /><br /># echo ondemand > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor<br /># dmesg | tail -n 1<br />ondemand governor failed, too long transition latency of HW, fallback to performance governor<br /><br />The thing is <a href="http://www.lesswatts.org/projects/powertop/">PowerTop</a> utility advices to run this command in order to get power consumption down. And it obviously does not work. Therefore I have <a href="https://bugzilla.redhat.com/show_bug.cgi?id=697273">reported</a> this behavior last weekend and Jaroslav Å karvada from Red Hat discovered and fixed an issue in Intel's PowerTOP with the long cpuinfo_transition_latency the day after. It will most likely be rolled out in some RHEL 6.X updates and fixed in upstream I guess.<br /><br />On top of that he recommended to workaround this by using an userspace mode with <b>cpuspeed</b> utility. If you have this kind Atom I recommend you to do this (example for Fedora/RHEL):<br /><br /># yum install cpuspeed<br /><br /># cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies<br />208333 416667 625001 833335 1041668 1250002 1458336 1666670<br /><br /># vim /etc/sysconfig/cpuspeed<br /><br />...<br />GOVERNOR=userspace<br />MIN_SPEED=416667<br />UP_THRESHOLD=80<br />DOWN_THRESHOLD=20<br />...<br /><br /># service cpuspeed start<br /><br /># chkconfig cpuspeed on<br /><br />I really recommend not to use the lowest possible frequency. My system tend to be little unresponsive when running at 200 MHz. I also recommend to tune the thresholds a bit. The default pair (15/25) is way too much. My setting (20/80) is pretty "conservative" but giving nice results on my system. I'd be pleased for sharing your opinions.<br /><br />This is same with all D-series Atoms like <b>D410, D425, D510, D525</b> and also Atom <b>200, 300</b>. Other series like N, E or Z have EIST. I have to admit you wont save much with EIST, because Atoms have very low TDP even without it. I am not sure if it worth it at all. Some measurements would be nice. Feel free to comment on that.<br /><br />Good reading regarding power management is definitely the <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html-single/Power_Management_Guide/index.html">RHEL 6 Power Management Guide</a>.