---
layout: post
title: How to prepare a gemfile package for Fedora
date: 2011-01-31
tags:
- fedora
- english
---

<h1>{{ page.title }}</h1>
It's a piece of cake to create a gemfile RPM package using the gem2rpm tool, but <a href="http://fedoraproject.org/wiki/Packaging/Ruby">Fedora Package Guidelines for Ruby</a> compliance is not that straightforward. Let me explain basic issues a packager will be facing to.<br /><br />The fist part is a duck soup. Really. Set the gem2rpm against downloaded <a href="http://rubygems.org">gem</a> file. Most likely you'll need to redirect it's standard output to a file. That's your starting point spec file. So far, so good, isn't it?<br /><br />Now the fun starts.<br /><br /><ul><li>Define sitelib and sitearch macros. <a href="https://github.com/lzap/acts_as_audited/commit/5afd6dd93f050d90d73c7851db4fdc6a2734c0bb">Example</a>.</li><li>Use %global instead of %define for all the others. <a href="https://github.com/lzap/acts_as_audited/commit/3a9fb048d0e45d97a144e2646154b311614ea507">Example</a>.</li><li>Add ruby(abi) requirement. <a href="https://github.com/lzap/acts_as_audited/commit/c313c9fc2a3b38b249da42aa171ab1607e28bc5e">Example</a>.</li><li>The gem2rpm tool starts with Requires only. If the gem has any build requirements you will need to convert them. The best place to find build requirements is the <a href="http://rubygems.org">gem</a> homepage. <a href="https://github.com/lzap/acts_as_audited/commit/c313c9fc2a3b38b249da42aa171ab1607e28bc5e">Example</a>.</li><li>Both %prep and %build sections should all be gone. <a href="https://github.com/lzap/acts_as_audited/commit/9336a514c85dc53ccd9f12f38671256352e3e89d">Example</a>.</li><li>The tool doesn't use macro in the files section. You can. <a href="https://github.com/lzap/acts_as_audited/commit/c8352d7eba66faf86ba320dbe304390f82bf54a6">Example</a>.</li><li>Both build root and clean sections are not necessarry for modern Fedoras. Wipe them out not blinking your eye. <a href="https://github.com/lzap/acts_as_audited/commit/5fe2c568e72c8072b377e48f87af4b2bfaab07f7">Example</a>.</li><li>You can cleanup the spec file at last. <a href="https://github.com/lzap/acts_as_audited/commit/762efd67dbf0a7791b176b092bad6c975c52f22a">Example</a>.</li><li>Checkout the upstream license as the gem2rpm puts "GPLv2 or Ruby" constrant there.</li></ul><br />This is not an universal blueprint. It only works for gems without native libraries or special artifacts. It has been prepared with Fedora 14 guidelines. Please note the guidelines can change in the future.<br /><br />That's all folks!