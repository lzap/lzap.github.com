---
layout: post
title: Skenovací server v Linuxu
date: 2011-02-24
tags:
- linux
---

<h1>{{ page.title }}</h1>
Potřeboval jsem dnes naskenovat jednu stránku. Jenže tiskárna Deskjet F300 je napojena na můj NAS server. Jak tedy skenovat přes síť?<br /><br />Předně je skenování nutné rozchodit "lokálně". V tomto případě je nutné nainstalovat hplip ovladač. Jelikož tiskárna není nejnovější, použil jsem ten z repozitářů v distribuci. Pomocí příkazu hp-setup jsem provedl nastavení. K tomuto ovladači se dodává pěkný program hp-check, který dokáže zkontrolovat spoustu chybějících programů a nastavení. Spouštět je ho dobré s parametrem -r (je to rychlejší nez bez něj).<br /><br />Lokálně lze skenovat například přesměrováním X protokolu přes ssh a spuštěním xsane. Jakmile toto funguje, můžeme se pustit do skenování "na dálku" pomocí jednoduché webové aplikace <a href="http://scannerserver.online02.com/">ScannerServer</a>. Tu muhou používat i takzvaní "negíci" (od slova geek).<br /><br />Celý ten máslostroj funguje jako CGI skript, takže jsem použil oblíbený webový server lighttpd a nakonfiguroval jej následovně:<br /><br /><script src="http://pastebin.com/embed_js.php?i=f5J1r76c"></script><br /><br />V podstatě tento soubor stačí zkopírovat z ukázkové konfigurace, není třeba měnit. Vidíme, že cgi-skripty se čtou v adresáři /usr/lib/cgi-bin. Tam jsem tedy nakopíroval obsah programu (adresář scan). Ale pod jakým uživatelem skripty poběží?<br /><br /><i># grep username /etc/lighttpd/lighttpd.conf <br />server.username            = "www-data"</i><br /><br />Uživatel www-data. Bezva. Jo mimochodem můžete si to rozchodit se svým oblíbeným http serverem (např. apache). Takže jak to bylo? Jo - www-data. Ve vaší distribuci to může být třeba nobody, nebo www. Je to jedno. ale musíme správně nastavit práva, protože CGI skript potřebuje někam zapsat konfiguraci a pochopitelně také naskenované obrázky. Že ano.<br /><br /><i># chown -R www-data /usr/lib/cgi-bin/scan</i><br /><br />Bacha, To ale není všechno. Nyní ten <b>špek</b>, který mi zabral asi 40 minut bádání, než jsem to vydoloval z logů. Uživatel www-data musí dostat práva na skenování.<br /><br /><i># usermod -G lp,lpadmin,saned www-data</i><br /><br />Asi by stačila jen skupina "saned", ale už nemám ani chuť ani čas zjišťovat, jestli lze ostatní skupiny vyhodit. Nyní stačí spustit lighttpd a přejít na adresu <i>localhost/cgi-bin/scan/index.cgi</i> a v nastavení kliknot na tlačítko detekce scanneru. V adresáři scan/config by se měl vytvořit soubor s konfigurací. Pokud je prázdný, skener není správně funkční a vraťte se k "lokálnímu" nastavování. Pokud je to ok, můžete ihned začít skenovat.<br /><br />Zítra mi přijde šest nových her na Playstation 3, takže se na chvilku zase odmlčím. Navíc mám ještě asi čtyři "na dohrávku" :-) Dobrou noc.<br /><br />Update: Instalace pro RHEL6 a Apache2 je snadná:<br /><br />1) Rozbalit do /var/www/html/scan/<br /><br /># ls /var/www/html/scan/<br />config  download.cgi  inc  index.cgi  print.cgi  README  scans<br /><br />2) Konfigurace a restart Apache:<br /><br /># cat /etc/httpd/conf.d/scan.conf <br /><Directory /var/www/html/scan><br />	Options +ExecCGI<br /></Directory><br /><br />AddHandler cgi-script cgi<br /><br />3) Instalace hplip, přidání do skupiny<br /><br /># yum -y install hplip sane-backends libsane-hpaio<br /># hp-setup -i<br /># ls -al /dev/sg0<br />crw-rw---- 1 root disk 21, 0 Aug 27 16:18 /dev/sg0<br /># usermod -G disk apache<br /># logout<br /><br /><br /><br /><br />